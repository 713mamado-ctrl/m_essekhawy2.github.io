<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>أضف رأيك</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
        margin: 0;
        padding: 20px;
        direction: rtl;
    }
    h1, h2 {
        text-align: center;
        color: #333;
    }
    #reviewsContainer {
        max-width: 600px;
        margin: 20px auto;
    }
    .review {
        background-color: #fff;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        position: relative;
    }
    .review p {
        margin: 5px 0;
    }
    .buttons {
        position: absolute;
        top: 10px;
        left: 10px;
        display: flex;
        gap: 5px;
    }
    .buttons button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 14px;
        color: #555;
    }
    form {
        max-width: 600px;
        margin: 20px auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    input, textarea {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 16px;
    }
    button[type="submit"] {
        padding: 10px 20px;
        border-radius: 5px;
        border: none;
        background-color: #1E3A8A;
        color: #fff;
        cursor: pointer;
        font-size: 16px;
    }
    button[type="submit"]:hover {
        background-color: #334EAA;
    }
    #formMessage {
        font-size: 14px;
        color: green;
    }
</style>
</head>
<body>

<h1>أضف رأيك</h1>

<div id="reviewsContainer"></div>

<section class="add-review">
<h2>أضف رأيك</h2>
<form id="reviewForm">
<input type="text" id="name" placeholder="اكتب اسمك" required>
<input type="email" id="email" placeholder="البريد الإلكتروني" required>
<textarea id="comment" placeholder="اكتب تعليقك هنا" required></textarea>
<button type="submit">إرسال</button>
<div id="formMessage" role="status" aria-live="polite"></div>
</form>
</section>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
    // إعداد Firebase
    const firebaseConfig = {
        apiKey: "ضع هنا API Key الخاص بك",
        authDomain: "ضع هنا authDomain الخاص بك",
        databaseURL: "ضع هنا databaseURL الخاص بك",
        projectId: "ضع هنا projectId الخاص بك",
        storageBucket: "ضع هنا storageBucket الخاص بك",
        messagingSenderId: "ضع هنا messagingSenderId الخاص بك",
        appId: "ضع هنا appId الخاص بك"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref("reviews");

    const form = document.getElementById("reviewForm");
    const reviewsContainer = document.getElementById("reviewsContainer");
    const formMessage = document.getElementById("formMessage");

    function createReviewElement(id, name, email, comment) {
        const div = document.createElement("div");
        div.classList.add("review");
        div.setAttribute("data-id", id);

        div.innerHTML = `
            <p><strong>${name}</strong> - ${email}</p>
            <p>${comment}</p>
            <div class="buttons">
                <button onclick="editReview('${id}')">تعديل</button>
                <button onclick="deleteReview('${id}')">حذف</button>
            </div>
        `;
        return div;
    }

    function displayReview(id, name, email, comment) {
        const reviewElement = createReviewElement(id, name, email, comment);
        reviewsContainer.prepend(reviewElement);
    }

    // تحميل الآراء من Firebase
    db.on("child_added", snapshot => {
        const data = snapshot.val();
        displayReview(snapshot.key, data.name, data.email, data.comment);
    });

    db.on("child_changed", snapshot => {
        const data = snapshot.val();
        const div = document.querySelector(`.review[data-id='${snapshot.key}']`);
        if(div) {
            div.querySelector("p:nth-child(1)").textContent = `${data.name} - ${data.email}`;
            div.querySelector("p:nth-child(2)").textContent = data.comment;
        }
    });

    db.on("child_removed", snapshot => {
        const div = document.querySelector(`.review[data-id='${snapshot.key}']`);
        if(div) div.remove();
    });

    form.addEventListener("submit", e => {
        e.preventDefault();
        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const comment = document.getElementById("comment").value.trim();

        if(!name || !email || !comment) return;

        // تحقق من صحة البريد الإلكتروني
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if(!emailPattern.test(email)) {
            formMessage.textContent = "يرجى إدخال بريد إلكتروني صحيح.";
            return;
        }

        const newReviewRef = db.push();
        newReviewRef.set({name, email, comment});

        formMessage.textContent = "تم إرسال رأيك بنجاح!";
        form.reset();
    });

    function deleteReview(id) {
        if(confirm("هل أنت متأكد أنك تريد حذف هذا الرأي؟")) {
            db.child(id).remove();
        }
    }

    function editReview(id) {
        const div = document.querySelector(`.review[data-id='${id}']`);
        const name = prompt("عدل الاسم:", div.querySelector("p:nth-child(1)").textContent.split(" - ")[0]);
        const email = prompt("عدل البريد الإلكتروني:", div.querySelector("p:nth-child(1)").textContent.split(" - ")[1]);
        const comment = prompt("عدل التعليق:", div.querySelector("p:nth-child(2)").textContent);
        if(name && email && comment) {
            db.child(id).update({name, email, comment});
        }
    }
</script>

</body>
</html>
