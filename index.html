<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø£Ø¶Ù Ø±Ø£ÙŠÙƒ</title>
<style>
body { font-family: Arial; background:#f7f7f7; margin:0; padding:20px; direction:rtl; }
h1 { text-align:center; color:#222; }
#reviewsContainer { max-width:600px; margin:20px auto; }
.review { background:#fff; border-radius:10px; padding:15px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); position:relative; }
.review p { margin:5px 0; }
.buttons { position:absolute; top:10px; left:10px; display:flex; gap:8px; }
.buttons button { background:none; border:none; cursor:pointer; font-size:14px; color:#555; }
form { max-width:600px; margin:30px auto; display:flex; flex-direction:column; gap:10px; }
input, textarea { padding:10px; border-radius:6px; border:1px solid #ccc; font-size:16px; }
button[type="submit"] { padding:10px 20px; border:none; background-color:#1E3A8A; color:#fff; border-radius:6px; font-size:16px; cursor:pointer; }
button[type="submit"]:hover { background-color:#334EAA; }
#formMessage { font-size:14px; color:green; }
</style>
</head>
<body>

<h1>Ø£Ø¶Ù Ø±Ø£ÙŠÙƒ</h1>
<div id="reviewsContainer"></div>

<form id="reviewForm">
<input type="text" id="name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ" required>
<input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
<textarea id="comment" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§" required></textarea>
<button type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
<div id="formMessage"></div>
</form>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "Ø¶Ø¹_Ø§Ù„Ù‚ÙŠÙ…Ø©_Ù‡Ù†Ø§",
  authDomain: "Ø¶Ø¹_Ø§Ù„Ù‚ÙŠÙ…Ø©_Ù‡Ù†Ø§",
  databaseURL: "Ø¶Ø¹_Ø§Ù„Ù‚ÙŠÙ…Ø©_Ù‡Ù†Ø§",
  projectId: "Ø¶Ø¹_Ø§Ù„Ù‚ÙŠÙ…Ø©_Ù‡Ù†Ø§",
  storageBucket: "Ø¶Ø¹_Ø§Ù„Ù‚ÙŠÙ…Ø©_Ù‡Ù†Ø§",
  messagingSenderId: "Ø¶Ø¹_Ø§Ù„Ù‚ÙŠÙ…Ø©_Ù‡Ù†Ø§",
  appId: "Ø¶Ø¹_Ø§Ù„Ù‚ÙŠÙ…Ø©_Ù‡Ù†Ø§"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database().ref("reviews");

const reviewsContainer = document.getElementById("reviewsContainer");
const form = document.getElementById("reviewForm");
const formMessage = document.getElementById("formMessage");

// Ø¯Ø§Ù„Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø£ÙŠ ÙƒØ§Ù…Ù„
function createReviewElement(id, name, email, comment){
    const div = document.createElement("div");
    div.classList.add("review");
    div.setAttribute("data-id", id);

    const nameEmailP = document.createElement("p");
    nameEmailP.innerHTML = `<strong>${name}</strong> - ${email}`;

    const commentP = document.createElement("p");
    commentP.textContent = comment;

    const btnDiv = document.createElement("div");
    btnDiv.classList.add("buttons");

    const editBtn = document.createElement("button");
    editBtn.textContent = "âœï¸ ØªØ¹Ø¯ÙŠÙ„";
    editBtn.onclick = () => editReview(id);

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "ğŸ—‘ï¸ Ø­Ø°Ù";
    deleteBtn.onclick = () => deleteReview(id);

    btnDiv.appendChild(editBtn);
    btnDiv.appendChild(deleteBtn);

    div.appendChild(nameEmailP);
    div.appendChild(commentP);
    div.appendChild(btnDiv);

    return div;
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø£ÙŠ
function displayReview(id, name, email, comment){
    const existingDiv = document.querySelector(`.review[data-id='${id}']`);
    if(existingDiv) existingDiv.remove(); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
    const div = createReviewElement(id,name,email,comment);
    reviewsContainer.prepend(div); // ÙŠØ¸Ù‡Ø± ÙÙˆÙ‚ Ø§Ù„ÙÙˆØ±Ù…
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ø±Ø§Ø¡ Ù…Ù† Firebase
db.on("child_added", snapshot => {
    const data = snapshot.val();
    displayReview(snapshot.key, data.name, data.email, data.comment);
});

db.on("child_changed", snapshot => {
    const data = snapshot.val();
    displayReview(snapshot.key, data.name, data.email, data.comment);
});

db.on("child_removed", snapshot => {
    const div = document.querySelector(`.review[data-id='${snapshot.key}']`);
    if(div) div.remove();
});

// Ø¥Ø±Ø³Ø§Ù„ Ø±Ø£ÙŠ Ø¬Ø¯ÙŠØ¯
form.addEventListener("submit", e=>{
    e.preventDefault();
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const comment = document.getElementById("comment").value.trim();
    if(!name || !email || !comment) return;

    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if(!emailPattern.test(email)){
        formMessage.textContent = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­.";
        return;
    }

    const newRef = db.push();
    newRef.set({name,email,comment});
    form.reset();
    formMessage.textContent = "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø£ÙŠÙƒ Ø¨Ù†Ø¬Ø§Ø­!";
});

// Ø­Ø°Ù Ø±Ø£ÙŠ
function deleteReview(id){
    if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ø£ÙŠØŸ")) db.child(id).remove();
}

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ ÙÙ‚Ø·
function editReview(id){
    const div = document.querySelector(`.review[data-id='${id}']`);
    const oldComment = div.querySelectorAll("p")[1].textContent;
    const newComment = prompt("Ø¹Ø¯Ù„ ØªØ¹Ù„ÙŠÙ‚Ùƒ:", oldComment);
    if(newComment && newComment.trim()!=="") db.child(id).update({comment:newComment.trim()});
}
</script>
</body>
</html>
